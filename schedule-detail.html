<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MadridForID | Schedule Detail</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --gold: #ffd700;
      --navy: #0b1d3a;
      --navy-soft: #10254d;
      --gray: #1a2238;
      --white: #ffffff;
      --red: #e63946;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; overflow-x: hidden; }
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(180deg, var(--navy) 0%, var(--navy-soft) 100%);
      color: var(--white);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
    }

    /* === Flyer Box === */
    .flyer-box {
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      margin-bottom: 25px;
      background: var(--gray);
      color: var(--white);
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
    }
    .flyer-box img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 10px;
      margin: 0 auto;
    }
    .flyer-box p {
      color: #c8c8d0;
      font-weight: 500;
      margin: 10px 0;
    }

    /* === Schedule Card === */
    .schedule-card {
      background: var(--gray);
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .schedule-card h2 {
      color: var(--white);
      font-weight: 700;
      margin-bottom: 10px;
    }
    .schedule-card p {
      margin: 6px 0;
      font-size: 0.95rem;
      color: #f0f0f0;
    }
    .status-btn {
      background: var(--gold);
      color: #000;
      font-weight: 700;
      padding: 6px 18px;
      border-radius: 8px;
      display: inline-block;
      margin-top: 10px;
    }
    .status-finished {
      background: rgba(255, 255, 255, 0.25);
      color: #ddd;
    }

    /* === Article Box === */
    .article-box {
      background: var(--gray);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      margin-bottom: 40px;
      color: var(--white);
    }
    .article-box h3 {
      margin-bottom: 10px;
      color: var(--white);
    }
    .article-box p {
      line-height: 1.6;
      text-align: justify;
      white-space: pre-line;
      color: #e5e5e5;
    }

    /* === Footer === */
    footer {
      background: var(--navy);
      color: var(--white);
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    /* === Buttons === */
    .back-btn, .delete-btn {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      margin: 10px 5px 20px;
      text-decoration: none;
    }
    .back-btn {
      background: var(--gold);
      color: #000;
    }
    .delete-btn {
      background: var(--red);
      color: white;
      border: none;
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Header include -->
  <div id="include-header"></div>
  <script>
  (async()=>{
    const res = await fetch("header.html?cb=" + Date.now());
    const html = await res.text();
    const container = document.getElementById("include-header");
    container.innerHTML = html;
    container.querySelectorAll("script").forEach((oldScript)=>{
      const newScript=document.createElement("script");
      if(oldScript.type)newScript.type=oldScript.type;
      if(oldScript.src)newScript.src=oldScript.src;
      else newScript.textContent=oldScript.textContent;
      document.body.appendChild(newScript);
    });
    window.dispatchEvent(new Event("header-ready"));
  })();
  </script>

  <main>
    <div class="flyer-box" id="flyerBox">
      <p>Loading flyer...</p>
    </div>

    <div class="schedule-card" id="matchCard">
      <h2 id="matchTitle">Loading...</h2>
      <p id="matchStadium">üèü Loading stadium...</p>
      <p id="matchDate">üìÖ Loading date...</p>
      <p id="matchTime">‚è∞ Loading time...</p>
      <p id="matchScore">‚öΩ Loading score...</p>
      <span id="matchStatus" class="status-btn">UPCOMING</span>
    </div>

    <div class="article-box">
      <h3>üîç Sorotan Utama</h3>
      <p id="article">Loading article...</p>
    </div>

    <div style="text-align:center;">
      <a href="schedule.html" class="back-btn">‚Üê Back to Schedule</a>
      <button id="deleteBtn" class="delete-btn" style="display:none;">üóë Delete</button>
    </div>
  </main>

  <footer>
    ¬© 2025 MadridForID | Fanbase Real Madrid Indonesia
  </footer>

  <script type="module">
window.addEventListener("header-ready", async () => {
  console.log("‚úÖ header-ready event triggered");

  try {
    // === Firebase import ===
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js");
    const { getFirestore, doc, getDoc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js");
    const { getAuth, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");

    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyA18AEH3-hByOQ7g9i3OJCJLzt4HDIJbpc",
      authDomain: "madridforid-web.firebaseapp.com",
      projectId: "madridforid-web",
      storageBucket: "madridforid-web.appspot.com",
      messagingSenderId: "882098167537",
      appId: "1:882098167537:web:acf50819e9c81adaad1350"
    };

    const ADMIN_UID = "T9MBugPPYLQ4HVu6uLBV3kEck3C2";
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // === Get URL ID ===
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    console.log("üÜî Schedule ID:", id);

    if (!id) {
      document.getElementById("flyerBox").innerHTML = "<p style='color:red;'>‚ùå Invalid ID</p>";
      return;
    }

    // === Fetch Firestore Document ===
    const docRef = doc(db, "schedule", id);
    const snap = await getDoc(docRef);

    if (!snap.exists()) {
      document.getElementById("flyerBox").innerHTML = "<p style='color:red;'>‚ùå Schedule not found</p>";
      return;
    }

    const data = snap.data();
    console.log("üìÑ Data loaded:", data);

    // === Render Data ===
    const flyerBox = document.getElementById("flyerBox");
    document.getElementById("matchTitle").textContent = data.match || "No Title";
    document.getElementById("matchStadium").textContent = `üèü ${data.stadium || "-"}`;
    document.getElementById("matchScore").textContent = `‚öΩ ${data.score || "-"}`;
    document.getElementById("article").textContent = data.article || "-";

    // === Flyer Logic (fix) ===
    const flyerUrl = data.flyerUrl || data.flyer || data.image || "";
    console.log("üñº Flyer URL:", flyerUrl);

    if (flyerUrl && flyerUrl.startsWith("https")) {
      flyerBox.innerHTML = `
        <div style="display:flex;justify-content:center;align-items:center;">
          <img src="${flyerUrl}" alt="Match Flyer" 
            style="max-width:100%;border-radius:12px;display:block;" 
            onerror="this.onerror=null;this.parentElement.innerHTML='<p style=color:red>‚ö†Ô∏è Flyer gagal dimuat</p>'"
          >
        </div>
      `;
    } else {
      flyerBox.innerHTML = "<p style='color:#ccc;'>No flyer found.</p>";
    }

    // === Date Handling ===
    const date = new Date(data.datetime);
    if (!isNaN(date)) {
      document.getElementById("matchDate").textContent = `üìÖ ${date.toLocaleDateString("id-ID", { day: "2-digit", month: "long", year: "numeric" })}`;
      document.getElementById("matchTime").textContent = `‚è∞ ${date.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" })} WIB`;
    }

    const now = new Date();
    const statusEl = document.getElementById("matchStatus");
    if (now > date) {
      statusEl.textContent = "FINISHED";
      statusEl.classList.add("status-finished");
    } else {
      statusEl.textContent = "UPCOMING";
    }

    // === Delete button for admin ===
    const deleteBtn = document.getElementById("deleteBtn");
    onAuthStateChanged(auth, (user) => {
      if (user && user.uid === ADMIN_UID) {
        deleteBtn.style.display = "inline-block";
        deleteBtn.addEventListener("click", async () => {
          if (confirm("Yakin hapus schedule ini?")) {
            await deleteDoc(docRef);
            alert("Schedule deleted!");
            window.location.href = "schedule.html";
          }
        });
      }
    });

  } catch (err) {
    console.error("üî• Error during schedule load:", err);
    document.getElementById("flyerBox").innerHTML = `<p style='color:red;'>Error loading data</p>`;
  }
});
</script>
</body>
</html>